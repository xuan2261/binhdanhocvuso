<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trắc nghiệm Ôn tập (Hỗ trợ nhiều đáp án)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; color: #333; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        #quiz-container { background-color: #fff; padding: 20px 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 800px; margin-top: 50px; }
        h1 { text-align: center; color: #0d6efd; margin-bottom: 25px; font-size: 1.8em; }
        #question-container { margin-bottom: 20px; }
        #question-text { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; line-height: 1.5; }
        #question-note { font-size: 0.9em; font-style: italic; color: #6c757d; margin-bottom: 20px; }
        #options-container label { display: block; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s ease-in-out; margin-bottom: 12px; }
        #options-container label:hover { background-color: #e9ecef; border-color: #0d6efd; }
        #options-container input { margin-right: 10px; }
        .correct { background-color: #d1e7dd !important; border-color: #badbcc !important; color: #0f5132; font-weight: bold; }
        .incorrect { background-color: #f8d7da !important; border-color: #f5c2c7 !important; color: #842029; }
        .missed { border: 2px solid #ffc107 !important; background-color: #fff3cd !important; }
        #controls { display: flex; justify-content: space-between; align-items: center; margin-top: 25px; padding-top: 15px; border-top: 1px solid #eee; }
        #submit-btn, #next-btn, #restart-btn { background-color: #0d6efd; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1em; cursor: pointer; transition: background-color 0.3s, box-shadow 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #submit-btn:hover, #next-btn:hover, #restart-btn:hover { background-color: #0b5ed7; box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        #progress { font-size: 1em; color: #6c757d; font-weight: 500; }
        #score-container { text-align: center; padding: 20px 0; }
        #score-text { font-size: 1.6em; margin-bottom: 25px; }
        .navigation-links-top { position: fixed; top: 0; left: 0; width: 100%; display: flex; justify-content: space-between; padding: 15px 20px; box-sizing: border-box; z-index: 1000; pointer-events: none; }
        .navigation-links-top .nav-link-top { background-color: #0d6efd; color: white; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-size: 0.9em; font-weight: 500; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transition: all 0.2s ease; pointer-events: auto; }
        .navigation-links-top .nav-link-top:hover { background-color: #0b5ed7; transform: scale(1.05); }
    </style>
</head>
<body>

    <div id="quiz-container">
        <h1>Ôn tập Trắc nghiệm</h1>
        <div id="question-container">
            <p id="question-text"></p>
            <p id="question-note"></p>
            <div id="options-container"></div>
        </div>
        <div id="controls">
            <span id="progress"></span>
            <button id="submit-btn">Kiểm tra đáp án</button>
            <button id="next-btn" style="display: none;">Câu tiếp theo</button>
        </div>
        <div id="score-container" style="display: none;">
            <p id="score-text"></p>
            <button id="restart-btn">Làm lại từ đầu</button>
        </div>
    </div>

    <!-- Nạp file dữ liệu mới. Thay đổi tên file nếu cần -->
    <script src="quizData-ChuyenDoiSo.js"></script>

    <script>
        // --- DOM Elements ---
        const questionText = document.getElementById('question-text');
        const questionNote = document.getElementById('question-note');
        const optionsContainer = document.getElementById('options-container');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        const progressText = document.getElementById('progress');
        const scoreContainer = document.getElementById('score-container');
        const scoreText = document.getElementById('score-text');
        const questionContainer = document.getElementById('question-container');
        const controlsContainer = document.getElementById('controls');
        
        // --- State Variables ---
        let shuffledQuestions, currentQuestionIndex, score;

        function startQuiz() {
            if (typeof quizData === 'undefined' || quizData.length === 0) {
                questionText.innerText = "Lỗi: Không thể tải dữ liệu câu hỏi.";
                return;
            }

            shuffledQuestions = [...quizData].sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            score = 0;
            
            scoreContainer.style.display = 'none';
            questionContainer.style.display = 'block';
            controlsContainer.style.display = 'flex';
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'block';

            setNextQuestion();
        }

        function setNextQuestion() {
            resetState();
            showQuestion(shuffledQuestions[currentQuestionIndex]);
        }

        function showQuestion(questionData) {
            questionText.innerText = questionData.question;
            optionsContainer.innerHTML = '';
            
            const isMultipleChoice = Array.isArray(questionData.answer);
            questionNote.innerText = isMultipleChoice ? `(Câu hỏi này có ${questionData.answer.length} đáp án đúng)` : '(Chọn một đáp án đúng)';

            for (const key in questionData.options) {
                const option = document.createElement('label');
                const input = document.createElement('input');
                input.type = isMultipleChoice ? 'checkbox' : 'radio';
                input.name = 'option';
                input.value = key;
                
                option.appendChild(input);
                option.appendChild(document.createTextNode(` ${key.toUpperCase()}. ${questionData.options[key]}`));
                optionsContainer.appendChild(option);
            }
        }

        function resetState() {
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'block';
            submitBtn.disabled = false;
            progressText.innerText = `Câu ${currentQuestionIndex + 1} / ${quizData.length}`;
        }
        
        function checkAnswer() {
            submitBtn.disabled = true;
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            const correctAnswer = currentQuestion.answer;
            const isMultipleChoice = Array.isArray(correctAnswer);
            
            const selectedInputs = optionsContainer.querySelectorAll('input:checked');
            const selectedAnswers = Array.from(selectedInputs).map(input => input.value);
            
            let isCorrect = false;
            
            if (isMultipleChoice) {
                // Sắp xếp để so sánh mảng
                isCorrect = selectedAnswers.length === correctAnswer.length && 
                            selectedAnswers.sort().every((value, index) => value === correctAnswer.sort()[index]);
            } else {
                isCorrect = selectedAnswers.length === 1 && selectedAnswers[0] === correctAnswer;
            }

            if (isCorrect) {
                score++;
            }

            // Show feedback
            const allLabels = optionsContainer.querySelectorAll('label');
            allLabels.forEach(label => {
                const input = label.querySelector('input');
                input.disabled = true;
                const isCorrectAnswer = isMultipleChoice ? correctAnswer.includes(input.value) : input.value === correctAnswer;
                const isSelected = selectedAnswers.includes(input.value);

                if (isCorrectAnswer) {
                    label.classList.add('correct');
                } else if (isSelected && !isCorrectAnswer) {
                    label.classList.add('incorrect');
                }
            });

            submitBtn.style.display = 'none';
            if (shuffledQuestions.length > currentQuestionIndex + 1) {
                nextBtn.style.display = 'block';
            } else {
                showScore();
            }
        }

        function showScore() {
            questionContainer.style.display = 'none';
            controlsContainer.style.display = 'none';
            scoreContainer.style.display = 'block';
            const percentage = Math.round((score / quizData.length) * 100);
            scoreText.innerHTML = `Bạn đã hoàn thành! <br> Kết quả: ${score} / ${quizData.length} câu đúng (${percentage}%)`;
        }
        
        submitBtn.addEventListener('click', checkAnswer);
        nextBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            setNextQuestion();
        });
        restartBtn.addEventListener('click', startQuiz);

        // Start the quiz
        startQuiz();
    </script>

</body>
</html>