<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫Øc nghi·ªám & Tra c·ª©u √în t·∫≠p</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; color: #333; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        #quiz-container { background-color: #fff; padding: 20px 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 800px; margin-top: 50px; }
        h1 { text-align: center; color: #0d6efd; margin-bottom: 25px; font-size: 1.8em; }
        #question-container { margin-bottom: 20px; }
        #question-text { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; line-height: 1.5; }
        #question-note { font-size: 0.9em; font-style: italic; color: #6c757d; margin-bottom: 20px; }
        #options-container label { display: block; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s ease-in-out; margin-bottom: 12px; }
        #options-container label:hover { background-color: #e9ecef; border-color: #0d6efd; }
        #options-container input { margin-right: 10px; transform: scale(1.2); }
        .correct { background-color: #d1e7dd !important; border-color: #badbcc !important; color: #0f5132; font-weight: bold; }
        .incorrect { background-color: #f8d7da !important; border-color: #f5c2c7 !important; color: #842029; }
        #controls { display: flex; justify-content: space-between; align-items: center; margin-top: 25px; padding-top: 15px; border-top: 1px solid #eee; }
        #submit-btn, #next-btn, #restart-btn { background-color: #0d6efd; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1em; cursor: pointer; transition: background-color 0.3s, box-shadow 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #submit-btn:hover, #next-btn:hover, #restart-btn:hover { background-color: #0b5ed7; box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        #progress { font-size: 1em; color: #6c757d; font-weight: 500; }
        #score-container { text-align: center; padding: 20px 0; }
        #score-text { font-size: 1.6em; margin-bottom: 25px; }
        .navigation-links-top { position: fixed; top: 0; left: 0; width: 100%; display: flex; justify-content: space-between; padding: 15px 20px; box-sizing: border-box; z-index: 1000; pointer-events: none; }
        .navigation-links-top .nav-link-top { background-color: #0d6efd; color: white; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-size: 0.9em; font-weight: 500; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transition: all 0.2s ease; pointer-events: auto; }
        .navigation-links-top .nav-link-top:hover { background-color: #0b5ed7; transform: scale(1.05); }

        /* CSS for Search Functionality */
        #search-box-container {
            margin-bottom: 25px;
        }
        #search-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        #search-input:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
            outline: none;
        }
        #search-results-container .result-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        #search-results-container .result-item:last-child {
            border-bottom: none;
        }
        .result-question {
            font-weight: bold;
            font-size: 1.1em;
            margin: 0 0 10px 0;
            line-height: 1.5;
        }
        .result-answer {
            margin: 0;
            padding-left: 20px;
            position: relative;
            line-height: 1.6;
        }
        .result-answer::before {
            content: '‚úî';
            color: #198754;
            font-weight: bold;
            position: absolute;
            left: 0;
            top: 2px;
        }
        .result-answer strong {
            color: #198754;
        }
    </style>
</head>
<body>

    <div class="navigation-links-top">
        <a href="markmap.html" class="nav-link-top">üó∫Ô∏è Mindmap</a>
        <!-- B·∫°n c√≥ th·ªÉ x√≥a n√∫t Tra c·ª©u n√†y ƒëi v√¨ ch·ª©c nƒÉng ƒë√£ ƒë∆∞·ª£c t√≠ch h·ª£p -->
        <!-- <a href="tim-kiem.html" class="nav-link-top">üîç Tra c·ª©u</a> -->
    </div>

    <div id="quiz-container">
        <h1>√în t·∫≠p Tr·∫Øc nghi·ªám & Tra c·ª©u</h1>

        <div id="search-box-container">
            <input type="text" id="search-input" placeholder="üîç G√µ ƒë·ªÉ tra c·ª©u nhanh c√¢u h·ªèi...">
        </div>
        <div id="search-results-container" style="display: none;"></div>
        
        <div id="question-container">
            <p id="question-text"></p>
            <p id="question-note"></p>
            <div id="options-container"></div>
        </div>

        <div id="controls">
            <span id="progress"></span>
            <button id="submit-btn">Ki·ªÉm tra ƒë√°p √°n</button>
            <button id="next-btn" style="display: none;">C√¢u ti·∫øp theo</button>
        </div>

        <div id="score-container" style="display: none;">
            <p id="score-text"></p>
            <button id="restart-btn">L√†m l·∫°i t·ª´ ƒë·∫ßu</button>
        </div>
    </div>
    
    <!-- N·∫°p file d·ªØ li·ªáu t·ª´ b√™n ngo√†i. Thay ƒë·ªïi t√™n file n·∫øu c·∫ßn -->
    <script src="quizData.js"></script>

    <script>
        // --- DOM Elements ---
        const quizContainer = document.getElementById('quiz-container');
        const questionContainer = document.getElementById('question-container');
        const questionText = document.getElementById('question-text');
        const questionNote = document.getElementById('question-note');
        const optionsContainer = document.getElementById('options-container');
        const controlsContainer = document.getElementById('controls');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressText = document.getElementById('progress');
        
        const scoreContainer = document.getElementById('score-container');
        const scoreText = document.getElementById('score-text');
        const restartBtn = document.getElementById('restart-btn');

        const searchInput = document.getElementById('search-input');
        const searchResultsContainer = document.getElementById('search-results-container');
        
        // --- State Variables ---
        let shuffledQuestions, currentQuestionIndex, score;

        // =================================================================
        // QUIZ LOGIC
        // =================================================================
        function startQuiz() {
            if (typeof quizData === 'undefined' || quizData.length === 0) {
                questionText.innerText = "L·ªói: Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu c√¢u h·ªèi. Vui l√≤ng ki·ªÉm tra file quizData.js.";
                return;
            }
            shuffledQuestions = [...quizData].sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            score = 0;
            
            scoreContainer.style.display = 'none';
            showQuizUI();
            
            setNextQuestion();
        }

        function setNextQuestion() {
            resetQuizState();
            showQuestion(shuffledQuestions[currentQuestionIndex]);
        }
        
        function showQuizUI() {
            questionContainer.style.display = 'block';
            controlsContainer.style.display = 'flex';
            searchResultsContainer.style.display = 'none';
        }

        function showQuestion(questionData) {
            questionText.innerText = questionData.question;
            optionsContainer.innerHTML = '';
            
            const isMultipleChoice = Array.isArray(questionData.answer);
            questionNote.innerText = isMultipleChoice ? `(C√¢u h·ªèi n√†y c√≥ ${questionData.answer.length} ƒë√°p √°n ƒë√∫ng)` : '(Ch·ªçn m·ªôt ƒë√°p √°n ƒë√∫ng)';

            for (const key in questionData.options) {
                if (questionData.options.hasOwnProperty(key)) {
                    const option = document.createElement('label');
                    const input = document.createElement('input');
                    input.type = isMultipleChoice ? 'checkbox' : 'radio';
                    input.name = 'option';
                    input.value = key;
                    
                    option.appendChild(input);
                    option.appendChild(document.createTextNode(` ${key.toUpperCase()}. ${questionData.options[key]}`));
                    optionsContainer.appendChild(option);
                }
            }
        }

        function resetQuizState() {
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'block';
            submitBtn.disabled = false;
            progressText.innerText = `C√¢u ${currentQuestionIndex + 1} / ${quizData.length}`;
        }
        
        function checkAnswer() {
            submitBtn.disabled = true;
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            const correctAnswer = currentQuestion.answer;
            const isMultipleChoice = Array.isArray(correctAnswer);
            
            const selectedInputs = optionsContainer.querySelectorAll('input:checked');
            const selectedAnswers = Array.from(selectedInputs).map(input => input.value);
            
            let isCorrect = false;
            
            if (isMultipleChoice) {
                // S·∫Øp x·∫øp ƒë·ªÉ so s√°nh m·∫£ng
                isCorrect = selectedAnswers.length === correctAnswer.length && 
                            selectedAnswers.sort().every((value, index) => correctAnswer.sort().includes(value));
            } else {
                isCorrect = selectedAnswers.length === 1 && selectedAnswers[0] === correctAnswer;
            }

            if (isCorrect) {
                score++;
            }

            const allLabels = optionsContainer.querySelectorAll('label');
            allLabels.forEach(label => {
                const input = label.querySelector('input');
                input.disabled = true;
                const isCorrectAnswer = isMultipleChoice ? correctAnswer.includes(input.value) : input.value === correctAnswer;
                const isSelected = selectedAnswers.includes(input.value);

                if (isCorrectAnswer) {
                    label.classList.add('correct');
                } else if (isSelected && !isCorrectAnswer) {
                    label.classList.add('incorrect');
                }
            });

            submitBtn.style.display = 'none';
            if (shuffledQuestions.length > currentQuestionIndex + 1) {
                nextBtn.style.display = 'block';
            } else {
                showScore();
            }
        }

        function showScore() {
            questionContainer.style.display = 'none';
            controlsContainer.style.display = 'none';
            scoreContainer.style.display = 'block';
            const percentage = Math.round((score / quizData.length) * 100);
            scoreText.innerHTML = `B·∫°n ƒë√£ ho√†n th√†nh! <br> K·∫øt qu·∫£: ${score} / ${quizData.length} c√¢u ƒë√∫ng (${percentage}%)`;
        }
        
        // =================================================================
        // SEARCH LOGIC
        // =================================================================
        function showSearchUI() {
            questionContainer.style.display = 'none';
            controlsContainer.style.display = 'none';
            scoreContainer.style.display = 'none';
            searchResultsContainer.style.display = 'block';
        }

        function performSearch() {
            const searchTerm = searchInput.value.toLowerCase().trim();

            if (searchTerm.length < 2) { // B·∫Øt ƒë·∫ßu t√¨m ki·∫øm khi c√≥ √≠t nh·∫•t 2 k√Ω t·ª±
                showQuizUI(); // Hi·ªÉn th·ªã l·∫°i giao di·ªán tr·∫Øc nghi·ªám
                searchResultsContainer.innerHTML = '';
                return;
            }

            showSearchUI(); // ·∫®n tr·∫Øc nghi·ªám, hi·ªán k·∫øt qu·∫£ t√¨m ki·∫øm

            const filteredResults = quizData.filter(item => {
                const questionText = item.question.toLowerCase();
                const optionsText = Object.values(item.options).join(' ').toLowerCase();
                return questionText.includes(searchTerm) || optionsText.includes(searchTerm);
            });

            displaySearchResults(filteredResults);
        }

        function displaySearchResults(results) {
            if (results.length === 0) {
                searchResultsContainer.innerHTML = '<p style="text-align: center; color: #6c757d;">Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi n√†o ph√π h·ª£p.</p>';
                return;
            }

            let htmlString = '';
            results.forEach(item => {
                let answerText = '';
                if (Array.isArray(item.answer)) {
                    answerText = item.answer.map(key => `${key.toUpperCase()}. ${item.options[key]}`).join('<br>');
                } else {
                    answerText = `${item.answer.toUpperCase()}. ${item.options[item.answer]}`;
                }

                htmlString += `
                    <div class="result-item">
                        <p class="result-question">${item.question}</p>
                        <p class="result-answer"><strong>ƒê√°p √°n ƒë√∫ng:</strong><br>${answerText}</p>
                    </div>
                `;
            });
            searchResultsContainer.innerHTML = htmlString;
        }

        // =================================================================
        // EVENT LISTENERS
        // =================================================================
        submitBtn.addEventListener('click', checkAnswer);
        nextBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            setNextQuestion();
        });
        restartBtn.addEventListener('click', startQuiz);
        searchInput.addEventListener('input', performSearch);

        // --- Start the application ---
        startQuiz();
    </script>
</body>
</html>